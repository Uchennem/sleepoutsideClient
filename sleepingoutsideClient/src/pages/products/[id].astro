---
import Layout from "../../layouts/Layout.astro";
import { type CollectionEntry, getCollection } from "astro:content";

// map though all products to create a page for each one
export async function getStaticPaths() {
  const products = await getCollection("products");

  return products.map((product) => ({
    params: { id: product.id },
    props: product
  }));
}
type Props = CollectionEntry<"products">;

// get the product data from the props to use in the template below. The actual data is in product.data
const product = Astro.props;
const title = product.data.name;
const imageSmall =
  product.data.images?.primarySmall ||
  product.data.images?.primaryMedium ||
  product.data.images?.primaryLarge ||
  product.data.images?.primaryExtraLarge ||
  product.data.image ||
  '/banner.jpg';
const imageMedium =
  product.data.images?.primaryMedium ||
  product.data.images?.primaryLarge ||
  product.data.images?.primaryExtraLarge ||
  product.data.image ||
  '/banner.jpg';
const imageLarge =
  product.data.images?.primaryLarge ||
  product.data.images?.primaryExtraLarge ||
  product.data.image ||
  '/banner.jpg';
const imageExtraLarge =
  product.data.images?.primaryExtraLarge ||
  product.data.images?.primaryLarge ||
  product.data.image ||
  '/banner.jpg';
---
<Layout title = {title}>
    <script src="../../js/product.ts"></script>
  
    <!-- Product details will go here -->
    <section class="product-detail">
    <h3>{product.data.brand?.name || product.data.brand || 'Brand'}</h3>

    <h2 class="divider">{product.data.nameWithoutBrand || product.data.name}</h2>

    <img
        class="divider"
      src={imageMedium}
      srcset={`${imageSmall} 320w, ${imageMedium} 640w, ${imageLarge} 960w, ${imageExtraLarge} 1280w`}
      sizes="(max-width: 600px) 95vw, (max-width: 1080px) 70vw, 500px"
        alt={product.data.nameWithoutBrand}
    />

    <p class="product-card__price">{product.data.finalPrice || product.data.price || 'Price TBA'}</p>

    <p class="product__color">{product.data.colors?.[0]?.colorName || product.data.color || ''}</p>

    <p class="product__description" set:html={product.data.descriptionHtmlSimple || product.data.description || ''}>
        
    </p>

    <div class="product-detail__add">
        <button id="addToCart" data-id={product.data.id}>Add to Cart</button>
    </div>
    </section>
  
</Layout>